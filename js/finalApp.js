//MAP SETUP
mapboxgl.accessToken = 'pk.eyJ1Ijoic3lkbmciLCJhIjoiY2pmY3JuM2x3M3poYjJ3bzFwZmV4ZHdwdCJ9.H7Kk8jKeATVVDR9qaVxU2Q';
var map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/dark-v9',
    zoom: 11,
    center: [-95.523752,30.177220]
});

map.addControl(new mapboxgl.NavigationControl());

//URL FOR GEOJSON
var promise = "https://raw.githubusercontent.com/sydng/Datasets/master/waterBodies.geojson";

//COORDINATES OF PHASE GEOJSON
var theCoords = {
  "type": "MultiPolygon",
  "coordinates": [ [ [
                      [ -95.502223434587933, 30.154836383418445 ],
                      [ -95.499374652987015, 30.157575597761163 ],
                      [ -95.491689014046429, 30.165925708639477 ],
                      [ -95.489196954026269, 30.162393161060571 ],
                      [ -95.485903374616868, 30.161113178284364 ],
                      [ -95.4812074362072, 30.158666351300347 ],
                      [ -95.482874525830553, 30.156695697200867 ],
                      [ -95.484530332089363, 30.15427775186361 ],
                      [ -95.487021380367921, 30.150948983423127 ],
                      [ -95.486782468242907, 30.148268599174028 ],
                      [ -95.484339659188009, 30.146674101695901 ],
                      [ -95.477306223976598, 30.146807109101839 ],
                      [ -95.474639651376307, 30.149989851456588 ],
                      [ -95.472845594694789, 30.153752748976082 ],
                      [ -95.469119571137682, 30.155762056760189 ],
                      [ -95.465714258610419, 30.156870257283156 ],
                      [ -95.462793913738551, 30.156775961790345 ],
                      [ -95.460858523292131, 30.15487316631906 ],
                      [ -95.462690126519064, 30.152601342900383 ],
                      [ -95.463003592236745, 30.151402152057351 ],
                      [ -95.461765642012423, 30.149933757978079 ],
                      [ -95.461728598291714, 30.148442820293333 ],
                      [ -95.460815293764796, 30.146222505281358 ],
                      [ -95.458238358513839, 30.146121654153472 ],
                      [ -95.456578310655232, 30.148390203968606 ],
                      [ -95.455253914004544, 30.150354125693092 ],
                      [ -95.45287057279991, 30.15114453159573 ],
                      [ -95.453162006743668, 30.149050789293948 ],
                      [ -95.451592189425298, 30.148035989188916 ],
                      [ -95.449996599412032, 30.145977502342102 ],
                      [ -95.450481753792204, 30.144775129237555 ],
                      [ -95.452339261119732, 30.143547109536389 ],
                      [ -95.453678401225886, 30.142179596617282 ],
                      [ -95.453466259698843, 30.140542761081495 ],
                      [ -95.450046510348486, 30.141054156861721 ],
                      [ -95.450834171383462, 30.138205328589024 ],
                      [ -95.4502679671333, 30.136127605259034 ],
                      [ -95.449048820350967, 30.135404544248459 ],
                      [ -95.446760031144549, 30.133060611969277 ],
                      [ -95.446701163460887, 30.13067507848168 ],
                      [ -95.446657017326899, 30.12888592772827 ],
                      [ -95.447660380386438, 30.127823066630562 ],
                      [ -95.448495886510727, 30.12691249468579 ],
                      [ -95.446605518518027, 30.126798584491802 ],
                      [ -95.444871967494947, 30.126085067019453 ],
                      [ -95.443463103711906, 30.124619657330442 ],
                      [ -95.443422699620143, 30.122979597009 ],
                      [ -95.445294615478133, 30.122348076340177 ],
                      [ -95.446286901949549, 30.120837939156868 ],
                      [ -95.447961496452251, 30.119165907559932 ],
                      [ -95.44982594460545, 30.118236135781899 ],
                      [ -95.451347356255596, 30.117312745257525 ],
                      [ -95.452346873005922, 30.11610076031852 ],
                      [ -95.449409319171977, 30.115260619362939 ],
                      [ -95.447810672286238, 30.113052968618405 ],
                      [ -95.448445140275481, 30.110952830570255 ],
                      [ -95.449937013171038, 30.108836692694492 ],
                      [ -95.451935903217503, 30.106412742605265 ],
                      [ -95.453683888005742, 30.10772256746289 ],
                      [ -95.456136309637515, 30.109765011823168 ],
                      [ -95.45924892553569, 30.110750891302587 ],
                      [ -95.461627561263228, 30.109811327420626 ],
                      [ -95.464050572643799, 30.110660855695464 ],
                      [ -95.467305113828658, 30.110450566264067 ],
                      [ -95.470876620448607, 30.109190086667361 ],
                      [ -95.472587740217676, 30.109008707469162 ],
                      [ -95.475186013241355, 30.11000388934286 ],
                      [ -95.477732219186592, 30.108911716705357 ],
                      [ -95.482537439848514, 30.108970102820198 ],
                      [ -95.483950342488839, 30.110584168187597 ],
                      [ -95.483689472714687, 30.113870684076264 ],
                      [ -95.481702446505622, 30.116742357155939 ],
                      [ -95.481762122407403, 30.119127832752532 ],
                      [ -95.483544304596208, 30.121779050662802 ],
                      [ -95.484797120232784, 30.123843613457925 ],
                      [ -95.486728555288181, 30.125596980444566 ],
                      [ -95.487817456636861, 30.127962939355221 ],
                      [ -95.48474514668645, 30.128617794859586 ],
                      [ -95.485468578256416, 30.130095718722437 ],
                      [ -95.488060047779612, 30.130792421630943 ],
                      [ -95.487571675165015, 30.131845815415542 ],
                      [ -95.486949169508406, 30.134393371410468 ],
                      [ -95.487695130323331, 30.136765824496852 ],
                      [ -95.488769223001, 30.138535399692454 ],
                      [ -95.488817889674181, 30.140473581841636 ],
                      [ -95.489366197534295, 30.141805636580031 ],
                      [ -95.491462126360801, 30.143257468907279 ],
                      [ -95.493844922116793, 30.142466388486664 ],
                      [ -95.495609108796089, 30.144371941416395 ],
                      [ -95.499158830301837, 30.142216110040359 ],
                      [ -95.498749476922967, 30.146400423409329 ],
                      [ -95.500166972080976, 30.148163350028945 ],
                      [ -95.501920089107458, 30.149621536114065 ],
                      [ -95.503002117466167, 30.15168914740666 ],
                      [ -95.502223434587933, 30.154836383418445 ]
                    ] ] ]
};
var theCoords2 = {
  "type": "MultiPolygon",
  "coordinates": [ [ [
                      [ -95.502223434587933, 30.154836383418445 ],
                      [ -95.504152035328204, 30.156440345647184 ],
                      [ -95.505349190149602, 30.156268322852995 ],
                      [ -95.507743484908147, 30.155924245154054 ],
                      [ -95.509988868783694, 30.156477936654998 ],
                      [ -95.51221914940021, 30.156435236731809 ],
                      [ -95.513576493894107, 30.155812590129102 ],
                      [ -95.514796329416598, 30.156535008144278 ],
                      [ -95.515158378006475, 30.157273866466507 ],
                      [ -95.515558299546854, 30.159503597850652 ],
                      [ -95.514757262320231, 30.161756361132376 ],
                      [ -95.515965818471429, 30.162031500952537 ],
                      [ -95.519568762419411, 30.16196232978649 ],
                      [ -95.521783963768328, 30.161323113395028 ],
                      [ -95.523697795795911, 30.162330415367258 ],
                      [ -95.525283733761768, 30.16394063993474 ],
                      [ -95.525336966932613, 30.166027846451122 ],
                      [ -95.52751385090744, 30.170609841981985 ],
                      [ -95.528413650360179, 30.172233244349702 ],
                      [ -95.526838623705899, 30.177782495099475 ],
                      [ -95.51851308681087, 30.187936379220396 ],
                      [ -95.512626611466544, 30.199534639024229 ],
                      [ -95.512652005431036, 30.207290441890084 ],
                      [ -95.51130533539758, 30.208360375421879 ],
                      [ -95.509913205918323, 30.207641253132657 ],
                      [ -95.504567311787852, 30.199987235814724 ],
                      [ -95.499393897792217, 30.192329672621767 ],
                      [ -95.493554915649838, 30.192291729218965 ],
                      [ -95.49136135042383, 30.19382505164749 ],
                      [ -95.489701374012384, 30.196094008451642 ],
                      [ -95.488269235998786, 30.200596033660389 ],
                      [ -95.487527323036247, 30.205234105074343 ],
                      [ -95.484034425015295, 30.202913790786575 ],
                      [ -95.480261988137499, 30.20313440909338 ],
                      [ -95.478228407430436, 30.204217013463001 ],
                      [ -95.476664907140815, 30.203500766491882 ],
                      [ -95.474564103581329, 30.201899677888687 ],
                      [ -95.473649934895562, 30.199679512488927 ],
                      [ -95.475463323954386, 30.196662038672809 ],
                      [ -95.477657215360992, 30.195128965766628 ],
                      [ -95.479366052850423, 30.194798326743943 ],
                      [ -95.47896300013943, 30.192419366918834 ],
                      [ -95.476869877707188, 30.191116483857844 ],
                      [ -95.474694709484837, 30.193394996701873 ],
                      [ -95.472370173169935, 30.196571265204486 ],
                      [ -95.470172438473369, 30.197955163893489 ],
                      [ -95.467922546621551, 30.197251741495741 ],
                      [ -95.465680119034957, 30.196846463082675 ],
                      [ -95.464419220853244, 30.194483582909051 ],
                      [ -95.462318803718219, 30.192882274100956 ],
                      [ -95.46111368643291, 30.1927557461504 ],
                      [ -95.460009747708327, 30.189793218572675 ],
                      [ -95.459625720330337, 30.188159636068878 ],
                      [ -95.459551586415955, 30.185177772887062 ],
                      [ -95.458619406416958, 30.18221200336173 ],
                      [ -95.456679856582866, 30.180160082532328 ],
                      [ -95.456434232101628, 30.177181424353275 ],
                      [ -95.456389827660075, 30.175392299338519 ],
                      [ -95.455144248362856, 30.173625671000789 ],
                      [ -95.454924582098428, 30.171690662024833 ],
                      [ -95.455738167643176, 30.169885468671797 ],
                      [ -95.454835851294618, 30.168112404394591 ],
                      [ -95.453415120842664, 30.166199868815752 ],
                      [ -95.455582859020467, 30.163623518485913 ],
                      [ -95.457466533908345, 30.163439071106293 ],
                      [ -95.457235761631495, 30.161056782564707 ],
                      [ -95.457713486777507, 30.159556197992206 ],
                      [ -95.458873776272043, 30.157893654114762 ],
                      [ -95.460858523292131, 30.15487316631906 ],
                      [ -95.462793913738551, 30.156775961790345 ],
                      [ -95.465714258610419, 30.156870257283156 ],
                      [ -95.472845594694789, 30.153752748976082 ],
                      [ -95.474639651376307, 30.149989851456588 ],
                      [ -95.477306223976598, 30.146807109101839 ],
                      [ -95.48228109764888, 30.146713069646573 ],
                      [ -95.484339659188009, 30.146674101695901 ],
                      [ -95.486782468242907, 30.148268599174028 ],
                      [ -95.487021380367921, 30.150948983423127 ],
                      [ -95.484530332089363, 30.15427775186361 ],
                      [ -95.482874525830553, 30.156695697200867 ],
                      [ -95.4812074362072, 30.158666351300347 ],
                      [ -95.483329345248748, 30.159772012772027 ],
                      [ -95.485903374616868, 30.161113178284364 ],
                      [ -95.489196954026269, 30.162393161060571 ],
                      [ -95.490184717482805, 30.163793374819889 ],
                      [ -95.491689014046429, 30.165925708639477 ],
                      [ -95.495670277769108, 30.161600461245634 ],
                      [ -95.499374652987015, 30.157575597761163 ],
                      [ -95.502223434587933, 30.154836383418445 ]
                    ] ] ]
};
var theCoords3 = {
  "type": "MultiPolygon",
  "coordinates": [ [ [
                      [ -95.501915841662637, 30.230913963532583 ],
                      [ -95.50284396914158, 30.226868923181389 ],
                      [ -95.50396260374599, 30.223566033184898 ],
                      [ -95.505786763711143, 30.220995438404859 ],
                      [ -95.506771404802393, 30.219186685861761 ],
                      [ -95.505173457013512, 30.217129020699183 ],
                      [ -95.502091014904593, 30.217486249986226 ],
                      [ -95.500825198480612, 30.214974703152311 ],
                      [ -95.49942172761466, 30.21380820693539 ],
                      [ -95.498823810992647, 30.210538091726058 ],
                      [ -95.498767273260981, 30.20830176860639 ],
                      [ -95.495292836857985, 30.206727219523646 ],
                      [ -95.493796890045104, 30.208694784667507 ],
                      [ -95.491923741848922, 30.20932706493441 ],
                      [ -95.489878912408017, 30.209962581877779 ],
                      [ -95.489520580198956, 30.209372748543299 ],
                      [ -95.487527323036247, 30.205234105074343 ],
                      [ -95.488269235998786, 30.200596033660421 ],
                      [ -95.48970137401237, 30.196094008451666 ],
                      [ -95.491361350423816, 30.193825051647497 ],
                      [ -95.493554915649838, 30.192291729218976 ],
                      [ -95.496653564910545, 30.192311897580822 ],
                      [ -95.499393897792203, 30.192329672621785 ],
                      [ -95.501925775143889, 30.196077482589263 ],
                      [ -95.504567311787852, 30.199987235814756 ],
                      [ -95.508598902812651, 30.205759630481015 ],
                      [ -95.509913205918338, 30.207641253132671 ],
                      [ -95.511305335397566, 30.208360375421893 ],
                      [ -95.512652005431022, 30.207290441890073 ],
                      [ -95.512633009242023, 30.201490077001647 ],
                      [ -95.512626611466544, 30.199534639024268 ],
                      [ -95.515383843459801, 30.194102344607398 ],
                      [ -95.518513086810856, 30.187936379220396 ],
                      [ -95.526838623705871, 30.177782495099482 ],
                      [ -95.528413650360179, 30.172233244349719 ],
                      [ -95.527513850907425, 30.170609841981996 ],
                      [ -95.525336966932585, 30.166027846451147 ],
                      [ -95.525283733761754, 30.16394063993474 ],
                      [ -95.525938046754789, 30.163445081769545 ],
                      [ -95.526325000004647, 30.163483 ],
                      [ -95.529532000004664, 30.165819999999876 ],
                      [ -95.531683000004719, 30.165106 ],
                      [ -95.535086000004753, 30.167497999999892 ],
                      [ -95.534719000004756, 30.168068999999889 ],
                      [ -95.536851000004773, 30.168257 ],
                      [ -95.536996000004805, 30.169229999999899 ],
                      [ -95.5386980000048, 30.16853699999989 ],
                      [ -95.541399000004844, 30.170278999999887 ],
                      [ -95.54307000000486, 30.170341 ],
                      [ -95.543120000004876, 30.169840999999899 ],
                      [ -95.544949000004891, 30.168994999999882 ],
                      [ -95.547176000004924, 30.169055 ],
                      [ -95.552205000004989, 30.170500999999895 ],
                      [ -95.552971000005002, 30.168840999999869 ],
                      [ -95.553947489337133, 30.168092333336361 ],
                      [ -95.554939732645082, 30.169034202229046 ],
                      [ -95.556003831396154, 30.170355881855009 ],
                      [ -95.558051209739887, 30.169868482636335 ],
                      [ -95.559115357960721, 30.171190133911768 ],
                      [ -95.560362685525661, 30.172955669992906 ],
                      [ -95.563958178984677, 30.172587093886552 ],
                      [ -95.569768691932637, 30.171578398525376 ],
                      [ -95.571987588007744, 30.17108742119046 ],
                      [ -95.574397421170957, 30.17133844057091 ],
                      [ -95.575532522833385, 30.168780489475086 ],
                      [ -95.579100590603886, 30.167367950005453 ],
                      [ -95.582746332899191, 30.168936907782644 ],
                      [ -95.584820765985768, 30.169492654032048 ],
                      [ -95.587963635395354, 30.171518839099328 ],
                      [ -95.591445885529609, 30.173389080106567 ],
                      [ -95.595052938493012, 30.173466890306983 ],
                      [ -95.598355970691827, 30.175042176338991 ],
                      [ -95.599276519110106, 30.177410407321851 ],
                      [ -95.598489058862626, 30.180110806235067 ],
                      [ -95.595829669556139, 30.183444903818952 ],
                      [ -95.592667022022667, 30.187236373724936 ],
                      [ -95.59139574519385, 30.191139547320528 ],
                      [ -95.589519749584895, 30.191624091872946 ],
                      [ -95.586461945331607, 30.192877715090514 ],
                      [ -95.584281615574653, 30.194859747000308 ],
                      [ -95.585556991637461, 30.197668543065681 ],
                      [ -95.58475733966975, 30.199921648040693 ],
                      [ -95.582939561882057, 30.202642288127404 ],
                      [ -95.579385881923073, 30.204651312402611 ],
                      [ -95.577021861354112, 30.206189385004592 ],
                      [ -95.575859247959542, 30.207703803469649 ],
                      [ -95.573811209308204, 30.208191518984052 ],
                      [ -95.569231136688956, 30.210369596343696 ],
                      [ -95.568575550196158, 30.211575699447852 ],
                      [ -95.56669129316019, 30.211761784133397 ],
                      [ -95.565111630536748, 30.21045031584849 ],
                      [ -95.562990015561468, 30.20810533439267 ],
                      [ -95.561207917967522, 30.205604521237827 ],
                      [ -95.560326557067597, 30.204726806333117 ],
                      [ -95.557576501923563, 30.204631356600764 ],
                      [ -95.555555392566731, 30.206162360106447 ],
                      [ -95.555601645520824, 30.207951340698415 ],
                      [ -95.556700920383307, 30.210614716841647 ],
                      [ -95.554141610684312, 30.211261263147296 ],
                      [ -95.550041252567922, 30.212086921915621 ],
                      [ -95.548027561859186, 30.213915987923787 ],
                      [ -95.545491141000142, 30.215456868812598 ],
                      [ -95.545209268858358, 30.217848862543725 ],
                      [ -95.541612031634827, 30.218217020487582 ],
                      [ -95.540128390531393, 30.22063231874764 ],
                      [ -95.538785699973616, 30.221851609696266 ],
                      [ -95.536275721941053, 30.224435914798729 ],
                      [ -95.532659081844798, 30.224058422623123 ],
                      [ -95.531312429187537, 30.22512856019074 ],
                      [ -95.529492710874592, 30.227848560068249 ],
                      [ -95.527440162263886, 30.228186501352518 ],
                      [ -95.523499081068394, 30.228560811968144 ],
                      [ -95.520053994061215, 30.228179669483406 ],
                      [ -95.517635224264424, 30.227629552163812 ],
                      [ -95.516333935094266, 30.230488575596727 ],
                      [ -95.514838101150588, 30.232456371402129 ],
                      [ -95.513487338674977, 30.233377255861271 ],
                      [ -95.509538388973084, 30.233452987892843 ],
                      [ -95.507134673114393, 30.233499027471311 ],
                      [ -95.504712043136763, 30.232799588063919 ],
                      [ -95.501915841662637, 30.230913963532583 ]
                    ] ] ]
};

var waterBodies;

//CREATE WEBPAGE
$(document).ready(function(){

  //was trying to use to add more data to the map
  //but couldn't get this to work with mapboxgl
  //also tried with their L.mapbox.feature().loadURL and kept getting undefined
  $.ajax(promise).done(function(data) {
      var parsedData = JSON.parse(data);
      waterBodies = L.geoJson(parsedData, {
        color: "blue"
      });

    $('#sidebar').hide();
    $('#about').hide();
    $('#myModal').modal('show');

    $('#exploreButton').on('click', function() {
      $('#sidebar').show();
    });

    //button is glitchy
    //works every other click because of bug in removing sources and layers
    $('#inundBox').click(function() {
      if($('#inundBox').prop("checked")) {
        map.addLayer({
          "id": "woodlands",
          "type": "heatmap",
          "source": {
            "type": "vector",
            "tiles": ["https://s3.us-east-2.amazonaws.com/jswoods/{z}/{x}/{y}.pbf"],
            "minzoom": 0,
            "maxzoom": 19
          },
          "source-layer": "WoodlandsPoints",
          "paint": {
            "heatmap-weight": [
                "interpolate",
                ["linear"],
                ["get", "Inundation"],
                0, 0,
                3, 1
            ],
            "heatmap-color": [
                "interpolate",
                ["linear"],
                ["heatmap-density"],
                0, "rgba(33,102,172,0)",
                0.2, "rgb(94,219,255)",
                0.4, "rgb(18,202,255)",
                0.6, "rgb(14,161,204)",
                0.8, "rgb(9,101,127)",
                1, "rgb(47,109,127)"
            ],
            'heatmap-opacity': 0.8
          }
        });
        map.addSource("woodlands");
      } else if($('#inundBox').prop("checked", false)) {
        map.removeSource("woodlands");
        map.removeLayer("woodlands");
      }
    });

    $('#phase1').click(function() {
      if($('#phase1').prop("checked")) {
        map.addSource("phase1", {
          "type": "geojson",
          "data": {
              "type": "Feature",
              "properties": { "Id": 1
                            },
              "geometry": theCoords
          }
        });
        map.addLayer({
          "id": "phase1",
          "type": "fill",
          "source": "phase1",
          "paint": {
            'fill-color': '#B5BDBF',
            'fill-opacity': 0.5
          }
        });
      } else if($('#phase1').prop("checked", false)) {
        map.removeLayer("phase1");
        map.removeSource("phase1");
      }
    });

    $('#phase2').click(function() {
      if($('#phase2').prop("checked")) {
        map.addSource("phase2", {
          "type": "geojson",
          "data": {
              "type": "Feature",
              "properties": { "Id": 2
                            },
              "geometry": theCoords2
          }
        });
        map.addLayer({
          "id": "phase2",
          "type": "fill",
          "source": "phase2",
          "paint": {
            'fill-color': '#B5BDBF',
            'fill-opacity': 0.5
          }
        });
      } else if($('#phase2').prop("checked", false)) {
        map.removeLayer("phase2");
        map.removeSource("phase2");
      }
    });

    $('#phase3').click(function() {
      if($('#phase3').prop("checked")) {
        map.addSource("phase3", {
          "type": "geojson",
          "data": {
              "type": "Feature",
              "properties": { "Id": 3
                            },
              "geometry": theCoords3
          }
        });
        map.addLayer({
          "id": "phase3",
          "type": "fill",
          "source": "phase3",
          "paint": {
            'fill-color': '#B5BDBF',
            'fill-opacity': 0.5
          }
        });
      } else if($('#phase3').prop("checked", false)) {
        map.removeLayer("phase3");
        map.removeSource("phase3");
      }
    });

    $('#aboutButton').on('click', function() {
      $('#myModal').modal('show');
      $('#map').css('top', '75px');
      $('#sidebar').hide();
      if($('#inundBox').prop("checked")) {
        map.removeSource("woodlands");
        map.removeLayer("woodlands");
        $('#inundBox').prop("checked", false);
      } else { }

      if($('#phase1').prop("checked")) {
        map.removeLayer("phase1");
        map.removeSource("phase1");
        $('#phase1').prop("checked", false);
      } else { }

      if($('#phase2').prop("checked")) {
        map.removeLayer("phase2");
        map.removeSource("phase2");
        $('#phase2').prop("checked", false);
      } else { }

      if($('#phase3').prop("checked")) {
        map.removeLayer("phase3");
        map.removeSource("phase3");
        $('#phase3').prop("checked", false);
      } else { }
    });

    $('#resourceButton').on('click', function() {
      $('#map').css('top', 'auto');
    });

    $('#closeIcon').on('click', function() {
      $('#sidebar').hide();
      if($('#inundBox').prop("checked")) {
        map.removeSource("woodlands");
        map.removeLayer("woodlands");
        $('#inundBox').prop("checked", false);
      } else { }

      if($('#phase1').prop("checked")) {
        map.removeLayer("phase1");
        map.removeSource("phase1");
        $('#phase1').prop("checked", false);
      } else { }

      if($('#phase2').prop("checked")) {
        map.removeLayer("phase2");
        map.removeSource("phase2");
        $('#phase2').prop("checked", false);
      } else { }

      if($('#phase3').prop("checked")) {
        map.removeLayer("phase3");
        map.removeSource("phase3");
        $('#phase3').prop("checked", false);
      } else { }
    });
  });
});
